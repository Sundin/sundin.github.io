<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Refactor Responsibly - Master of Software Engineering</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Master of Software Engineering" rel=home><div class="logo__item logo__text"><div class=logo__title>Master of Software Engineering</div></div></a></div><div class=divider></div></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Refactor Responsibly</h1><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>Gustav Sundin</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2018-09-22T20:34:11Z>2018-09-22</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/Refactoring/ rel=category>Refactoring</a></span></div></div></header><div class="content post__content clearfix"><p>Rewriting a large piece of software from scratch is <a href=https://www.joelonsoftware.com/2000/04/06/things-you-should-never-do-part-i/>usually not a good idea</a>, regardless of how messy or problematic the original/legacy code is. The reason is that you never know how long the rewrite is gonna take, what unexpected problems you might run into or even if your new solution is gonna be any better than the old. You might end up spending several months on refactoring without any possibility of releasing anything into production until the rewrite is complete. Remember that all code that&rsquo;s written but not released is a huge cause for concern as its the perfect breeding ground for hidden bugs.</p><p>If you are not convinced, here are some other reasons why you should be careful with mindlessly throwing away legacy code:</p><ul><li>By rewriting you lose <a href=http://cdn.pols.co.uk/papers/agile-approach-to-legacy-systems.pdf>accumulated knowledge in form of bug fixes that catches corner cases</a>.</li><li>Remember <a href=https://abovethelaw.com/2014/01/the-fallacy-of-chestertons-fence/>Chesterton&rsquo;s fence</a>: code is not written without a reason. Therefore, don&rsquo;t delete seemingly unnecessary code until you understand why it was put there in the first place.</li><li>The code you write today will be the legacy code of tomorrow.</li><li>Make sure you are able to [finish what you start]({{ site.baseurl }}{% post_url 2018-09-28-last-week-mindset %}).</li></ul><h2 id=patterns-of-responsible-refactoring>Patterns of responsible refactoring</h2><p>One useful strategy for mitigating the inherent risk of refactoring is to isolate the functionality you want to rewrite into smaller chunks. This will enable you to release small pieces code into production continously, meaning that you can verify that what you are building is actually working and giving you the possibility of backtracking or changing course at any point in a very agile way. In case you hit a dead end, you can always fall back to your latest working version without having to discard weeks or months worth of work.
More often than not, it will also force you to come up with a more robust software architecture as well!</p><p>Some architectural patterns can be used in order to execute this theory into practice. They are all very similiar and/or overlapping, with the main idea being to be able to shorten the release cycle in order to get quicker feedback and reduce overall risk.</p><h3 id=proxy-pattern>Proxy pattern</h3><p>Hide your legacy solution behind a proxy component. Useful while migrating backend code. In the first iteration, the proxy will simply forward all calls to the old system. Later on the proxy will take on more and more responsibility, one step at a time, until the old system at some point becomes completely superfluous.</p><h3 id=exoskeleton-pattern>Exoskeleton pattern</h3><p>Put your old code inside a shell that&rsquo;s running the new framework you have chosen to use. Rewrite the old code one small piece at a time and move it out into the outer layer. When all code has been migrated, the inner layer can be deleted. The Exoskeleton pattern, which Martin Fowler calls the <a href=https://www.martinfowler.com/bliki/StranglerApplication.html>Strangler pattern</a>], could be a useful strategy if for example porting an existing app to another framework.</p><p>Some things to keep in mind while using the Exoskeleton pattern:</p><ul><li>Cover your legacy code with tests, then replace code piece by piece, and all the while <a href="https://www.youtube.com/watch?v=aWiwDdx_rdo">keeping the tests green</a>. This is probably the number one, most valuable lesson to learn in order to succeed with any form of refactoring.</li><li><a href=https://www.martinfowler.com/bliki/EventInterception.html>Event Intercepton</a>: This is a technique recommended by Martin Fowler himself when doing this type of refactoring. Tap into the stream of events flowing into your legacy system from the outside world. Make sure these events also arrive into your shiny new exoskeleton. Once you have that foundation in place, you can start moving actual functionality out into the exoskeleton.</li><li><a href=https://www.martinfowler.com/bliki/AssetCapture.html>Asset capture</a>: Once you have your Event Interception into place, Martin Fowler suggest you continue by moving one type of data entity (i.e., one type of asset) at a time into your new system. The more finegrained entity/asset type you are able to identify, the better (again, it&rsquo;s better to start small and build from there). In order to get this to work, you will need to be able to synchronize all entries of that certain type into the new system, and ideally also be able to synchronize them back again. This approach will make sure you have your back covered until your new system is able to handle all the various use cases concering that asset/entity type.</li></ul><h2 id=final-words>Final words</h2><p>I hope you will think twice before you utter the dreaded words &ldquo;let&rsquo;s rebuild it from scratch&rdquo; next time. It is extremely important to tackle technical debt at a continuous basis, but problematic legacy code needs to be refactored responsibly, one piece at a time, rather than blindly. Please don&rsquo;t risk taking on more than you can chew.</p><p>This being said, you should never be afraid of deleting code that is not being used (for instance commented-out or &ldquo;dead&rdquo; code that cannot be reached at runtime). Hopefully you are using a version control system like Git, meaning you can always retrieve the deleted code again if you (against all odds) might need it back.</p></div></article></main><div class="authorbox clearfix"><div class=authorbox__header><span class=authorbox__name>About Gustav Sundin</span></div><div class=authorbox__description>My name is Gustav Sundin and I currently work as software engineering consultant at Devies in Gothenburg, Sweden. I also hold a Master’s degree in Software Engineering from Chalmers University. A cool thing with that is that I am allowed to titulate myself “Master of Software Engineering”!</div><br>Follow me with <b><a href=/feed.xml>RSS</a></b>.</br><br><i>Did I make a mistake? Please feel free to <b><a href=https://github.com/Sundin/sundin.github.io>issue a pull request to my Github repo</a></b>.</i></br></div><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/post/2018-09-22-welcome/ rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>Welcome!</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/post/2018-09-28-last-week-mindset/ rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>The Last Week Mindset</p></a></div></nav></div><aside class=sidebar><div class="widget-recent widget"><h4 class=widget__title>Recent Posts</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/post/2021-04-14-kubernetes-tutorial/>A short Kubernetes tutorial</a></li><li class=widget__item><a class=widget__link href=/post/2021-04-12-avoid-else/>Avoid using else statements</a></li><li class=widget__item><a class=widget__link href=/post/2021-04-08-minimize-java-lambda-coldstarts/>Minimize Java Lambda Cold Start Times</a></li><li class=widget__item><a class=widget__link href=/post/2021-03-30-dynamodb-migrations/>Migrating data between DynamoDB tables</a></li><li class=widget__item><a class=widget__link href=/post/2020-11-11-dns-record-types/>DNS Record Types</a></li></ul></div></div><div class="widget-categories widget"><h4 class=widget__title>Categories</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/categories/AWS/>AWS</a>&nbsp;
<span class="widget__counter widget__counter--bubble">2</span></li><li class=widget__item><a class=widget__link href=/categories/Agility/>Agility</a>&nbsp;
<span class="widget__counter widget__counter--bubble">4</span></li><li class=widget__item><a class=widget__link href=/categories/Architecture/>Architecture</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/DNS/>DNS</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li><li class=widget__item><a class=widget__link href=/categories/Implementation/>Implementation</a>&nbsp;
<span class="widget__counter widget__counter--bubble">4</span></li><li class=widget__item><a class=widget__link href=/categories/Learning/>Learning</a>&nbsp;
<span class="widget__counter widget__counter--bubble">2</span></li><li class=widget__item><a class=widget__link href=/categories/Mindset/>Mindset</a>&nbsp;
<span class="widget__counter widget__counter--bubble">3</span></li><li class=widget__item><a class=widget__link href=/categories/Patterns/>Patterns</a>&nbsp;
<span class="widget__counter widget__counter--bubble">2</span></li><li class=widget__item><a class=widget__link href=/categories/Refactoring/>Refactoring</a>&nbsp;
<span class="widget__counter widget__counter--bubble">3</span></li><li class=widget__item><a class=widget__link href=/categories/Testing/>Testing</a>&nbsp;
<span class="widget__counter widget__counter--bubble">3</span></li><li class=widget__item><a class=widget__link href=/categories/Workflow/>Workflow</a>&nbsp;
<span class="widget__counter widget__counter--bubble">1</span></li></ul></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Gustav Sundin.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>